<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¡ä¾‹ãƒ†ã‚­ã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ã‚¢ - çµ±åˆåˆ†æç‰ˆ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <style>
    :root {
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;
  --color-bg-1: rgba(59, 130, 246, 0.08);
  --color-bg-2: rgba(245, 158, 11, 0.08);
  --color-bg-3: rgba(34, 197, 94, 0.08);
  --color-bg-4: rgba(239, 68, 68, 0.08);
  --color-bg-5: rgba(147, 51, 234, 0.08);
  --color-bg-6: rgba(249, 115, 22, 0.08);
  --color-bg-7: rgba(236, 72, 153, 0.08);
  --color-bg-8: rgba(6, 182, 212, 0.08);
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;
  --space-0: 0;
  --space-1: 1px;
  --space-2: 2px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-10: 10px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.03);
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
  --container-sm: 640px;
  --container-md: 768px;
  --container-lg: 1024px;
  --container-xl: 1280px;
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;
    --color-bg-1: rgba(29, 78, 216, 0.15);
    --color-bg-2: rgba(180, 83, 9, 0.15);
    --color-bg-3: rgba(21, 128, 61, 0.15);
    --color-bg-4: rgba(185, 28, 28, 0.15);
    --color-bg-5: rgba(107, 33, 168, 0.15);
    --color-bg-6: rgba(194, 65, 12, 0.15);
    --color-bg-7: rgba(190, 24, 93, 0.15);
    --color-bg-8: rgba(8, 145, 178, 0.15);
    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
    --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -1px 0 rgba(0, 0, 0, 0.15);
    --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);
  }
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2') format('woff2');
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  font-size: var(--font-size-base);
  font-family: var(--font-family-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
}

body {
  margin: 0;
  padding: 0;
}

.app-container {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.header {
  background-color: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  padding: var(--space-20) var(--space-32);
  box-shadow: var(--shadow-sm);
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--space-16);
}

.header h1 {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  letter-spacing: var(--letter-spacing-tight);
}

.header-tabs {
  display: flex;
  gap: var(--space-8);
}

.tab-btn {
  padding: var(--space-8) var(--space-16);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-medium);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  background-color: var(--color-surface);
  color: var(--color-text);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
}

.tab-btn:hover {
  background-color: var(--color-secondary-hover);
}

.tab-btn.active {
  background-color: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-color: var(--color-primary);
}

.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: var(--space-24);
  gap: var(--space-24);
}

@media (min-width: 1024px) {
  .main-content {
    flex-direction: row;
  }
}

.filter-section {
  flex: 0 0 auto;
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
}

@media (min-width: 1024px) {
  .filter-section {
    width: 420px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
    position: sticky;
    top: var(--space-24);
  }
}

.filter-card {
  background-color: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-16);
  box-shadow: var(--shadow-sm);
}

.filter-card h2 {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  margin-bottom: var(--space-12);
  color: var(--color-text);
}

.button-grid {
  display: grid;
  gap: var(--space-6);
}

.button-grid.municipalities {
  grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
}

.button-grid.codings {
  grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
}

.button-grid.analysis-filters {
  grid-template-columns: 1fr;
}

.filter-btn {
  padding: var(--space-6) var(--space-10);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  background-color: var(--color-surface);
  color: var(--color-text);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.filter-btn:hover {
  background-color: var(--color-secondary-hover);
  border-color: var(--color-primary);
}

.filter-btn:focus-visible {
  outline: none;
  box-shadow: var(--focus-ring);
}

.filter-btn.selected {
  background-color: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-color: var(--color-primary);
  font-weight: var(--font-weight-semibold);
}

.filter-btn.selected:hover {
  background-color: var(--color-primary-hover);
}

.reset-btn {
  width: 100%;
  padding: var(--space-10) var(--space-16);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-semibold);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  background-color: var(--color-surface);
  color: var(--color-text);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
}

.reset-btn:hover {
  background-color: var(--color-secondary-hover);
}

.reset-btn:focus-visible {
  outline: none;
  box-shadow: var(--focus-ring);
}

.display-section {
  flex: 1;
  min-width: 0;
}

.view-container {
  display: none;
}

.view-container.active {
  display: block;
}

.stats-bar {
  background-color: var(--color-bg-1);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-base);
  padding: var(--space-12) var(--space-16);
  margin-bottom: var(--space-16);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.paragraphs-container {
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
}

.paragraph-card {
  background-color: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-16);
  box-shadow: var(--shadow-sm);
  transition: box-shadow var(--duration-normal) var(--ease-standard);
}

.paragraph-card:hover {
  box-shadow: var(--shadow-md);
}

.paragraph-header {
  background-color: var(--color-bg-2);
  padding: var(--space-8) var(--space-12);
  border-radius: var(--radius-sm);
  margin-bottom: var(--space-12);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
}

.paragraph-meta {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-8);
  margin-bottom: var(--space-8);
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
}

.municipality-badge {
  display: inline-flex;
  align-items: center;
  gap: var(--space-4);
  padding: var(--space-4) var(--space-8);
  background-color: var(--color-bg-3);
  border-radius: var(--radius-sm);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
}

.analysis-badges {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-6);
  margin-top: var(--space-8);
}

.badge {
  padding: var(--space-4) var(--space-8);
  border-radius: var(--radius-sm);
  font-size: var(--font-size-xs);
  font-weight: var(--font-weight-medium);
  white-space: nowrap;
}

.badge.regulation-type {
  background-color: var(--color-bg-1);
  color: var(--color-text);
}

.badge.zone-type {
  background-color: var(--color-bg-5);
  color: var(--color-text);
}

.badge.strictness {
  color: white;
}

.badge.strictness.very-strict {
  background-color: rgba(220, 38, 38, 0.8);
}

.badge.strictness.strict {
  background-color: rgba(234, 88, 12, 0.8);
}

.badge.strictness.standard {
  background-color: rgba(250, 204, 21, 0.7);
  color: var(--color-text);
}

.badge.strictness.lenient {
  background-color: rgba(34, 197, 94, 0.7);
  color: var(--color-text);
}

.badge.process {
  background-color: var(--color-bg-6);
  color: var(--color-text);
}

.badge.editable {
  cursor: pointer;
  position: relative;
  transition: transform var(--duration-fast) var(--ease-standard);
}

.badge.editable:hover {
  transform: scale(1.05);
  opacity: 0.9;
}

.badge.editable::after {
  content: 'âœï¸';
  font-size: 10px;
  margin-left: 4px;
  opacity: 0.6;
}

.edit-dropdown {
  position: absolute;
  top: 100%;
  left: 0;
  margin-top: 4px;
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  box-shadow: var(--shadow-lg);
  padding: var(--space-8);
  z-index: 1000;
  min-width: 200px;
  display: none;
}

.edit-dropdown.show {
  display: block;
}

.edit-dropdown label {
  display: block;
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-4);
  font-weight: var(--font-weight-medium);
}

.edit-dropdown select {
  width: 100%;
  padding: var(--space-6) var(--space-8);
  font-size: var(--font-size-sm);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  background-color: var(--color-surface);
  color: var(--color-text);
  margin-bottom: var(--space-8);
  cursor: pointer;
}

.edit-dropdown select:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: var(--focus-ring);
}

.edit-dropdown-buttons {
  display: flex;
  gap: var(--space-6);
  margin-top: var(--space-8);
}

.edit-dropdown button {
  flex: 1;
  padding: var(--space-6) var(--space-8);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
}

.edit-dropdown button.save-btn {
  background-color: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-color: var(--color-primary);
}

.edit-dropdown button.save-btn:hover {
  background-color: var(--color-primary-hover);
}

.edit-dropdown button.cancel-btn {
  background-color: var(--color-surface);
  color: var(--color-text);
}

.edit-dropdown button.cancel-btn:hover {
  background-color: var(--color-secondary-hover);
}

.paragraph-text {
  font-size: var(--font-size-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  white-space: pre-wrap;
  word-wrap: break-word;
}

.highlight {
  background-color: rgba(245, 158, 11, 0.3);
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-sm);
  font-weight: var(--font-weight-medium);
}

/* Dashboard styles */
.dashboard-container {
  display: grid;
  gap: var(--space-20);
}

.dashboard-section {
  background-color: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-20);
  box-shadow: var(--shadow-sm);
}

.dashboard-section h2 {
  font-size: var(--font-size-xl);
  font-weight: var(--font-weight-semibold);
  margin-bottom: var(--space-16);
  color: var(--color-text);
}

.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: var(--space-16);
}

.chart-container {
  position: relative;
  height: 300px;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-12);
}

.stat-card {
  background-color: var(--color-bg-1);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-base);
  padding: var(--space-12);
  text-align: center;
}

.stat-value {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
}

.stat-label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-top: var(--space-4);
}

.loading {
  text-align: center;
  padding: var(--space-32);
  font-size: var(--font-size-lg);
  color: var(--color-text-secondary);
}

.error {
  background-color: rgba(var(--color-error-rgb), 0.1);
  border: 1px solid var(--color-error);
  border-radius: var(--radius-base);
  padding: var(--space-16);
  color: var(--color-error);
  margin: var(--space-16);
}

.no-results {
  text-align: center;
  padding: var(--space-32);
  font-size: var(--font-size-base);
  color: var(--color-text-secondary);
}

/* Scrollbar styling */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--color-secondary);
  border-radius: var(--radius-sm);
}

::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: var(--radius-sm);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-secondary);
}
  </style>
</head>
<body>
  <div class="app-container">
    <header class="header">
      <div class="header-content">
        <h1>æ¡ä¾‹ãƒ†ã‚­ã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ã‚¢ - çµ±åˆåˆ†æç‰ˆ</h1>
        <div class="header-tabs">
          <button class="tab-btn active" data-view="text">ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º</button>
          <button class="tab-btn" data-view="dashboard">çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</button>
        </div>
      </div>
    </header>
    
    <main class="main-content">
      <aside class="filter-section">
        <div class="filter-card">
          <h2>ğŸ¢ è‡ªæ²»ä½“ã‚’é¸æŠ</h2>
          <div id="municipalities" class="button-grid municipalities"></div>
        </div>
        
        <div class="filter-card">
          <h2>ğŸ“‹ ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’é¸æŠ</h2>
          <div id="codings" class="button-grid codings"></div>
        </div>
        
        <div class="filter-card">
          <h2>ğŸ” åˆ†æãƒ•ã‚£ãƒ«ã‚¿</h2>
          
          <h3 style="font-size: 14px; margin: 12px 0 8px; color: var(--color-text-secondary);">è¦åˆ¶ã‚¿ã‚¤ãƒ—</h3>
          <div id="regulationTypes" class="button-grid analysis-filters"></div>
          
          <h3 style="font-size: 14px; margin: 12px 0 8px; color: var(--color-text-secondary);">åŒºåŸŸé¡å‹</h3>
          <div id="zoneTypes" class="button-grid analysis-filters"></div>
          
          <h3 style="font-size: 14px; margin: 12px 0 8px; color: var(--color-text-secondary);">å³æ ¼åº¦ãƒ¬ãƒ™ãƒ«</h3>
          <div id="strictnessLevels" class="button-grid analysis-filters"></div>
          
          <h3 style="font-size: 14px; margin: 12px 0 8px; color: var(--color-text-secondary);">ãƒ—ãƒ­ã‚»ã‚¹é‡è¦–åº¦</h3>
          <div id="processTypes" class="button-grid analysis-filters"></div>
        </div>
        
        <button id="resetBtn" class="reset-btn">ğŸ”„ ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆ</button>
      </aside>
      
      <section class="display-section">
        <!-- Text View -->
        <div id="textView" class="view-container active">
          <div id="stats" class="stats-bar"></div>
          <div id="paragraphs" class="paragraphs-container"></div>
        </div>
        
        <!-- Dashboard View -->
        <div id="dashboardView" class="view-container">
          <div class="dashboard-container">
            <div class="dashboard-section">
              <h2>ğŸ“Š å…¨ä½“çµ±è¨ˆ</h2>
              <div class="stats-grid" id="overallStats"></div>
            </div>
            
            <div class="dashboard-section">
              <h2>ğŸ“ˆ åˆ†å¸ƒã‚°ãƒ©ãƒ•</h2>
              <div class="dashboard-grid">
                <div class="chart-container">
                  <canvas id="regulationChart"></canvas>
                </div>
                <div class="chart-container">
                  <canvas id="zoneChart"></canvas>
                </div>
                <div class="chart-container">
                  <canvas id="strictnessChart"></canvas>
                </div>
                <div class="chart-container">
                  <canvas id="processChart"></canvas>
                </div>
              </div>
            </div>
            
            <div class="dashboard-section">
              <h2>ğŸ¯ ã‚¹ã‚³ã‚¢åˆ†æ</h2>
              <div class="dashboard-grid">
                <div class="chart-container">
                  <canvas id="scatterStrictnessResident"></canvas>
                </div>
                <div class="chart-container">
                  <canvas id="scatterStrictnessProcedure"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    let allData = {};
    let municipalities = [];
    let codingTypes = [];
    let municipalityInfo = {};
    let statistics = {};
    let selectedMunicipality = null;
    let selectedCodes = [];
    let selectedRegulationType = null;
    let selectedZoneType = null;
    let selectedStrictnessLevel = null;
    let selectedProcessType = null;
    let currentView = 'text';
    let charts = {};

    // ãƒ‡ãƒ¼ã‚¿å–å¾—
    async function fetchData() {
      const response = await fetch('data-integrated.json?t=' + new Date().getTime());
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return await response.json();
    }

    // åˆæœŸåŒ–
    async function init() {
      try {
        showLoading();
        allData = await fetchData();
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’è¨­å®š
        municipalities = allData.municipalities || [];
        coding_types = allData.coding_types || [];
        municipality_info = allData.municipality_info || {};
        statistics = allData.statistics || {};
        
        initializeUI();
        updateDisplay();
        setupEventListeners();
        setupTabSwitching();
        
      } catch (error) {
        console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
        showError('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
      } finally {
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚’æ¶ˆã™ï¼ˆã‚‚ã—ã‚ã‚Œã°ï¼‰
        const loadingEl = document.querySelector('.loading');
        if (loadingEl) loadingEl.remove();
      }
    }
    
    // UIã‚’åˆæœŸåŒ–
    function initializeUI() {
      // è‡ªæ²»ä½“ãƒœã‚¿ãƒ³ã‚’ç”Ÿæˆ
      const municipalityContainer = document.getElementById('municipalities');
      municipalityContainer.innerHTML = ''; // Clear existing
      municipalities.forEach(mun => {
        const btn = document.createElement('button');
        btn.textContent = mun;
        btn.className = 'filter-btn';
        btn.setAttribute('data-municipality', mun);
        btn.addEventListener('click', () => selectMunicipality(mun, btn));
        municipalityContainer.appendChild(btn);
      });

      // ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ã‚’ç”Ÿæˆ
      const codingContainer = document.getElementById('codings');
      codingContainer.innerHTML = ''; // Clear existing
      coding_types.forEach(code => {
        const btn = document.createElement('button');
        btn.textContent = code;
        btn.className = 'filter-btn';
        btn.setAttribute('data-coding', code);
        btn.addEventListener('click', () => toggleCoding(code, btn));
        codingContainer.appendChild(btn);
      });

      // åˆ†æãƒ•ã‚£ãƒ«ã‚¿ã‚’ç”Ÿæˆ
      initializeAnalysisFilters();

      // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
      document.getElementById('resetBtn').addEventListener('click', resetFilters);
    }

    // åˆ†æãƒ•ã‚£ãƒ«ã‚¿ã‚’åˆæœŸåŒ–
    function initializeAnalysisFilters() {
      // è¦åˆ¶ã‚¿ã‚¤ãƒ—
      const regulationTypes = Object.keys(statistics['è¦åˆ¶ã‚¿ã‚¤ãƒ—åˆ†å¸ƒ'] || {});
      const regulationContainer = document.getElementById('regulationTypes');
      regulationContainer.innerHTML = ''; // Clear existing
      regulationTypes.forEach(type => {
        const btn = createAnalysisFilterButton(type, () => {
          toggleAnalysisFilter('regulation', type, btn);
        });
        regulationContainer.appendChild(btn);
      });

      // åŒºåŸŸé¡å‹
      const zoneTypes = Object.keys(statistics['åŒºåŸŸé¡å‹åˆ†å¸ƒ'] || {});
      const zoneContainer = document.getElementById('zoneTypes');
      zoneContainer.innerHTML = ''; // Clear existing
      zoneTypes.forEach(type => {
        const btn = createAnalysisFilterButton(type, () => {
          toggleAnalysisFilter('zone', type, btn);
        });
        zoneContainer.appendChild(btn);
      });

      // å³æ ¼åº¦ãƒ¬ãƒ™ãƒ«
      const strictnessLevels = ['éå¸¸ã«å³æ ¼', 'å³æ ¼', 'æ¨™æº–', 'ç·©ã‚„ã‹'];
      const strictnessContainer = document.getElementById('strictnessLevels');
      strictnessContainer.innerHTML = ''; // Clear existing
      strictnessLevels.forEach(level => {
        const btn = createAnalysisFilterButton(level, () => {
          toggleAnalysisFilter('strictness', level, btn);
        });
        strictnessContainer.appendChild(btn);
      });

      // ãƒ—ãƒ­ã‚»ã‚¹é‡è¦–åº¦
      const processTypes = Object.keys(statistics['ãƒ—ãƒ­ã‚»ã‚¹é‡è¦–åº¦åˆ†å¸ƒ'] || {});
      const processContainer = document.getElementById('processTypes');
      processContainer.innerHTML = ''; // Clear existing
      processTypes.forEach(type => {
        const btn = createAnalysisFilterButton(type, () => {
          toggleAnalysisFilter('process', type, btn);
        });
        processContainer.appendChild(btn);
      });
    }

    function createAnalysisFilterButton(text, onClick) {
      const btn = document.createElement('button');
      btn.textContent = text;
      btn.className = 'filter-btn';
      btn.addEventListener('click', onClick);
      return btn;
    }

    function toggleAnalysisFilter(filterType, value, btnElement) {
      const filterMap = {
        'regulation': 'selectedRegulationType',
        'zone': 'selectedZoneType',
        'strictness': 'selectedStrictnessLevel',
        'process': 'selectedProcessType'
      };
      
      const varName = filterMap[filterType];
      const currentValue = window[varName];
      
      // åŒã˜ã‚«ãƒ†ã‚´ãƒªã®ä»–ã®ãƒœã‚¿ãƒ³ã‚’è§£é™¤
      btnElement.parentElement.querySelectorAll('.filter-btn.selected').forEach(b => {
        b.classList.remove('selected');
      });
      
      if (currentValue === value) {
        window[varName] = null;
      } else {
        window[varName] = value;
        btnElement.classList.add('selected');
      }
      
      updateDisplay();
    }

    // è‡ªæ²»ä½“ã‚’é¸æŠ
    function selectMunicipality(mun, btnElement) {
      if (selectedMunicipality === mun) {
        selectedMunicipality = null;
        btnElement.classList.remove('selected');
      } else {
        document.querySelectorAll('[data-municipality].selected').forEach(b => {
          b.classList.remove('selected');
        });
        selectedMunicipality = mun;
        btnElement.classList.add('selected');
      }
      updateDisplay();
    }

    // ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’é¸æŠ/è§£é™¤
    function toggleCoding(code, btnElement) {
      const index = selectedCodes.indexOf(code);
      if (index > -1) {
        selectedCodes.splice(index, 1);
        btnElement.classList.remove('selected');
      } else {
        selectedCodes.push(code);
        btnElement.classList.add('selected');
      }
      updateDisplay();
    }

    // ãƒ•ã‚£ãƒ«ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
    function resetFilters() {
      selectedMunicipality = null;
      selectedCodes = [];
      selectedRegulationType = null;
      selectedZoneType = null;
      selectedStrictnessLevel = null;
      selectedProcessType = null;
      
      document.querySelectorAll('.filter-btn.selected').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      updateDisplay();
    }

    // è¡¨ç¤ºã‚’æ›´æ–°
    function updateDisplay() {
      const filtered = filterParagraphs();
      displayParagraphs(filtered);
    }

    // æ®µè½ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    function filterParagraphs() {
      let filtered = allData.paragraphs || [];
      
      // è‡ªæ²»ä½“ã§ãƒ•ã‚£ãƒ«ã‚¿
      if (selectedMunicipality) {
        filtered = filtered.filter(p => p.municipality === selectedMunicipality);
      }
      
      // åˆ†æãƒ•ã‚£ãƒ«ã‚¿ã§ãƒ•ã‚£ãƒ«ã‚¿
      if (selectedRegulationType || selectedZoneType || selectedStrictnessLevel || selectedProcessType) {
        // è©²å½“è‡ªæ²»ä½“ã®ãƒªã‚¹ãƒˆã‚’å–å¾—
        const validMunicipalities = Object.keys(municipality_info).filter(mun => {
          const info = municipality_info[mun];
          if (selectedRegulationType && info['è¦åˆ¶ã‚¿ã‚¤ãƒ—'] !== selectedRegulationType) return false;
          if (selectedZoneType && info['åŒºåŸŸé¡å‹'] !== selectedZoneType) return false;
          if (selectedStrictnessLevel && info['å³æ ¼åº¦_çµ¶å¯¾'] !== selectedStrictnessLevel) return false;
          if (selectedProcessType && info['ãƒ—ãƒ­ã‚»ã‚¹é‡è¦–åº¦'] !== selectedProcessType) return false;
          return true;
        });
        
        filtered = filtered.filter(p => validMunicipalities.includes(p.municipality));
      }
      
      // ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã§ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆANDæ¡ä»¶ï¼‰
      if (selectedCodes.length > 0) {
        filtered = filtered.filter(p => {
          return selectedCodes.every(code => p.codes && p.codes.includes(code));
        });
      }
      
      return filtered;
    }

    // æ®µè½ã‚’è¡¨ç¤º
    function displayParagraphs(paragraphs) {
      const container = document.getElementById('paragraphs');
      const statsBar = document.getElementById('stats');
      
      // çµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤º
      let statsText = `è¡¨ç¤ºä»¶æ•°: ${paragraphs.length}ä»¶`;
      if (selectedMunicipality) {
        statsText += ` | è‡ªæ²»ä½“: ${selectedMunicipality}`;
      }
      if (selectedRegulationType) {
        statsText += ` | è¦åˆ¶: ${selectedRegulationType}`;
      }
      if (selectedZoneType) {
        statsText += ` | åŒºåŸŸ: ${selectedZoneType}`;
      }
      if (selectedStrictnessLevel) {
        statsText += ` | å³æ ¼åº¦: ${selectedStrictnessLevel}`;
      }
      if (selectedProcessType) {
        statsText += ` | ãƒ—ãƒ­ã‚»ã‚¹: ${selectedProcessType}`;
      }
      if (selectedCodes.length > 0) {
        statsText += ` | ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°: ${selectedCodes.join(', ')}`;
      }
      statsBar.textContent = statsText;
      
      container.innerHTML = '';
      
      if (paragraphs.length === 0) {
        const noResults = document.createElement('div');
        noResults.className = 'no-results';
        noResults.textContent = 'è©²å½“ã™ã‚‹æ®µè½ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ';
        container.appendChild(noResults);
        return;
      }
      
      paragraphs.forEach(para => {
        const card = document.createElement('div');
        card.className = 'paragraph-card';
        
        // ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†
        const header = document.createElement('div');
        header.className = 'paragraph-header';
        const codes = para.codes && para.codes.length > 0 ? para.codes.join(', ') : 'ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãªã—';
        header.textContent = `[${para.h5}-${para.dan}] ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°: ${codes}`;
        card.appendChild(header);
        
        // ãƒ¡ã‚¿æƒ…å ±
        const meta = document.createElement('div');
        meta.className = 'paragraph-meta';
        
        if (para.municipality) {
          const munBadge = document.createElement('div');
          munBadge.className = 'municipality-badge';
          munBadge.textContent = `ğŸ¢ ${para.municipality}`;
          meta.appendChild(munBadge);
        }
        if (para.year) {
          const yearSpan = document.createElement('span');
          yearSpan.textContent = `å¹´: ${para.year}`;
          meta.appendChild(yearSpan);
        }
        if (para.category) {
          const catSpan = document.createElement('span');
          catSpan.textContent = `åŒºåˆ†: ${para.category}`;
          meta.appendChild(catSpan);
        }
        
        card.appendChild(meta);
        
        // åˆ†æãƒãƒƒã‚¸ã‚’è¿½åŠ 
        const munInfo = municipality_info[para.municipality];
        if (munInfo) {
          const analysisBadges = document.createElement('div');
          analysisBadges.className = 'analysis-badges';
          
          // è¦åˆ¶ã‚¿ã‚¤ãƒ—
          const regBadge = createEditableBadge(
            'badge regulation-type',
            munInfo['è¦åˆ¶ã‚¿ã‚¤ãƒ—'],
            para.municipality,
            'è¦åˆ¶ã‚¿ã‚¤ãƒ—',
            Object.keys(statistics['è¦åˆ¶ã‚¿ã‚¤ãƒ—åˆ†å¸ƒ'] || {})
          );
          analysisBadges.appendChild(regBadge);
          
          // åŒºåŸŸé¡å‹
          const zoneBadge = createEditableBadge(
            'badge zone-type',
            munInfo['åŒºåŸŸé¡å‹'],
            para.municipality,
            'åŒºåŸŸé¡å‹',
            Object.keys(statistics['åŒºåŸŸé¡å‹åˆ†å¸ƒ'] || {})
          );
          analysisBadges.appendChild(zoneBadge);
          
          // å³æ ¼åº¦
          const strictBadge = createEditableBadge(
            'badge strictness ' + getStrictnessClass(munInfo['å³æ ¼åº¦_çµ¶å¯¾']),
            `å³æ ¼åº¦: ${munInfo['å³æ ¼åº¦_çµ¶å¯¾']}`,
            para.municipality,
            'å³æ ¼åº¦_çµ¶å¯¾',
            ['éå¸¸ã«å³æ ¼', 'å³æ ¼', 'æ¨™æº–', 'ç·©ã‚„ã‹']
          );
          analysisBadges.appendChild(strictBadge);
          
          // ãƒ—ãƒ­ã‚»ã‚¹é‡è¦–åº¦
          const procBadge = createEditableBadge(
            'badge process',
            munInfo['ãƒ—ãƒ­ã‚»ã‚¹é‡è¦–åº¦'],
            para.municipality,
            'ãƒ—ãƒ­ã‚»ã‚¹é‡è¦–åº¦',
            Object.keys(statistics['ãƒ—ãƒ­ã‚»ã‚¹é‡è¦–åº¦åˆ†å¸ƒ'] || {})
          );
          analysisBadges.appendChild(procBadge);
          
          card.appendChild(analysisBadges);
        }
        
        // æœ¬æ–‡
        const text = document.createElement('div');
        text.className = 'paragraph-text';
        text.innerHTML = highlightText(para.text, para.codes || []);
        card.appendChild(text);
        
        container.appendChild(card);
      });
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆå§”è­²ã®ãŸã‚ã®ãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    function setupEventListeners() {
      const paragraphsContainer = document.getElementById('paragraphs');
      paragraphsContainer.addEventListener('click', (e) => {
        const badge = e.target.closest('.editable');
        if (badge) {
          e.stopPropagation();
          const { municipality, field, options } = badge.dataset;
          showEditDropdown(badge, municipality, field, JSON.parse(options));
        }
      });
    }

    function getStrictnessClass(level) {
      const map = {
        'éå¸¸ã«å³æ ¼': 'very-strict',
        'å³æ ¼': 'strict',
        'æ¨™æº–': 'standard',
        'ç·©ã‚„ã‹': 'lenient'
      };
      return map[level] || 'standard';
    }

    // ç·¨é›†å¯èƒ½ãªãƒãƒƒã‚¸ã‚’ä½œæˆ
    function createEditableBadge(className, text, municipality, field, options) {
      const badge = document.createElement('span');
      badge.className = className + ' editable';
      badge.textContent = text;
      
      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ä»£ã‚ã‚Šã«dataå±æ€§ã‚’ä½¿ç”¨
      badge.dataset.municipality = municipality;
      badge.dataset.field = field;
      badge.dataset.options = JSON.stringify(options);
      
      return badge;
    }

    // ç·¨é›†ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’è¡¨ç¤º
    function showEditDropdown(badgeElement, municipality, field, options) {
      // ãƒ‡ãƒãƒƒã‚°æƒ…å ±
      console.log('showEditDropdown called:', { municipality, field, options, currentValue: municipality_info[municipality]?.[field] });
      
      // æ—¢å­˜ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’é–‰ã˜ã‚‹
      document.querySelectorAll('.edit-dropdown').forEach(d => d.remove());
      
      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      if (!municipality_info[municipality]) {
        console.error(`Municipality not found: ${municipality}`);
        showToast(`è‡ªæ²»ä½“æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${municipality}`, 'error');
        return;
      }
      
      if (!options || options.length === 0) {
        console.error(`No options provided for field: ${field}`);
        showToast(`é¸æŠè‚¢ãŒã‚ã‚Šã¾ã›ã‚“: ${field}`, 'error');
        return;
      }
      
      const dropdown = document.createElement('div');
      dropdown.className = 'edit-dropdown show';
      
      // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³å†…ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¼æ’­ã•ã›ãªã„
      dropdown.addEventListener('click', (e) => {
        e.stopPropagation();
      });
      
      const label = document.createElement('label');
      label.textContent = `${field}ã‚’ç·¨é›†:`;
      dropdown.appendChild(label);
      
      const select = document.createElement('select');
      const currentValue = municipality_info[municipality][field];
      
      console.log('Creating select options:', options);
      
      // selectã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¼æ’­ã•ã›ãªã„
      select.addEventListener('click', (e) => {
        e.stopPropagation();
      });
      
      select.addEventListener('change', (e) => {
        e.stopPropagation();
      });
      
      options.forEach(option => {
        const opt = document.createElement('option');
        opt.value = option;
        opt.textContent = option;
        if (option === currentValue) {
          opt.selected = true;
        }
        select.appendChild(opt);
      });
      dropdown.appendChild(select);
      
      const buttons = document.createElement('div');
      buttons.className = 'edit-dropdown-buttons';
      
      const saveBtn = document.createElement('button');
      saveBtn.className = 'save-btn';
      saveBtn.textContent = 'ä¿å­˜';
      saveBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const newValue = select.value;
        console.log('Save clicked:', { municipality, field, newValue });
        saveMunicipalityEdit(municipality, field, newValue, badgeElement);
        dropdown.remove();
      });
      buttons.appendChild(saveBtn);
      
      const cancelBtn = document.createElement('button');
      cancelBtn.className = 'cancel-btn';
      cancelBtn.textContent = 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«';
      cancelBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        console.log('Cancel clicked');
        dropdown.remove();
      });
      buttons.appendChild(cancelBtn);
      
      dropdown.appendChild(buttons);
      badgeElement.appendChild(dropdown);
      
      // å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã¨ãƒãƒƒã‚¸ä»¥å¤–ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆï¼‰
      setTimeout(() => {
        const closeDropdown = (e) => {
          if (!dropdown.contains(e.target) && !badgeElement.contains(e.target)) {
            dropdown.remove();
            document.removeEventListener('click', closeDropdown);
          }
        };
        document.addEventListener('click', closeDropdown);
      }, 100);
    }

    // è‡ªæ²»ä½“æƒ…å ±ã®ç·¨é›†ã‚’ä¿å­˜
    async function saveMunicipalityEdit(municipality, field, newValue, badgeElement) {
      try {
        // ãƒ¡ãƒ¢ãƒªå†…ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
        const oldValue = municipality_info[municipality][field];
        municipality_info[municipality][field] = newValue;
        
        // data-integrated.json ã‚’æ›´æ–°
        allData.municipality_info = municipality_info;
        
        // ã‚µãƒ¼ãƒãƒ¼ã«ä¿å­˜ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡(PHPã‚µãƒ¼ãƒãƒ¼ãŒã‚ã‚‹å ´åˆ)
        try {
          const response = await fetch('save-edit.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              municipality: municipality,
              field: field,
              value: newValue
            })
          });
          
          if (response.ok) {
            const result = await response.json();
            if (result.success) {
              updateBadgeDisplay(badgeElement, field, newValue);
              showToast(`${municipality}ã®${field}ã‚’æ›´æ–°ã—ã¾ã—ãŸ (ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: ${result.backup})`, 'success');
              updateDisplay();
              return;
            }
          }
        } catch (fetchError) {
          // PHPã‚µãƒ¼ãƒãƒ¼ãŒãªã„å ´åˆã¯æ¬¡ã®å‡¦ç†ã¸
          console.log('PHPã‚µãƒ¼ãƒãƒ¼ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚');
        }
        
        // PHPãŒä½¿ãˆãªã„å ´åˆã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã‚’æä¾›
        updateBadgeDisplay(badgeElement, field, newValue);
        
        showToast(
          `${municipality}ã®${field}ã‚’ã€Œ${oldValue}ã€ã‹ã‚‰ã€Œ${newValue}ã€ã«æ›´æ–°ã—ã¾ã—ãŸã€‚\nã€ŒJSONãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ãƒœã‚¿ãƒ³ã§ä¿å­˜ã—ã¦ãã ã•ã„ã€‚`, 
          'warning'
        );
        
        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
        showDownloadButton();
        updateDisplay();
        
      } catch (error) {
        console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        
        // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
        municipality_info[municipality][field] = oldValue;
        
        showToast('ç·¨é›†ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    // ãƒãƒƒã‚¸è¡¨ç¤ºã‚’æ›´æ–°
    function updateBadgeDisplay(badgeElement, field, newValue) {
      const displayText = field === 'å³æ ¼åº¦_çµ¶å¯¾' ? `å³æ ¼åº¦: ${newValue}` : newValue;
      badgeElement.textContent = displayText;
      
      // å³æ ¼åº¦ã®å ´åˆã€ã‚¯ãƒ©ã‚¹ã‚‚æ›´æ–°
      if (field === 'å³æ ¼åº¦_çµ¶å¯¾') {
        badgeElement.className = badgeElement.className.replace(/very-strict|strict|standard|lenient/g, '');
        badgeElement.className += ' ' + getStrictnessClass(newValue);
      }
    }

    // JSONãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
    function showDownloadButton() {
      if (document.getElementById('download-json-btn')) return; // æ—¢ã«å­˜åœ¨ã™ã‚‹å ´åˆ
      
      const btn = document.createElement('button');
      btn.id = 'download-json-btn';
      btn.innerHTML = 'ğŸ’¾ JSONãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰';
      btn.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 12px 24px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: var(--shadow-lg);
        z-index: 9999;
        transition: all 0.3s;
        animation: pulse 2s infinite;
      `;
      
      btn.addEventListener('mouseover', () => {
        btn.style.transform = 'scale(1.05)';
        btn.style.boxShadow = '0 8px 20px rgba(102, 126, 234, 0.4)';
      });
      
      btn.addEventListener('mouseout', () => {
        btn.style.transform = 'scale(1)';
        btn.style.boxShadow = 'var(--shadow-lg)';
      });
      
      btn.addEventListener('click', downloadJSON);
      
      document.body.appendChild(btn);
      
      // ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
      if (!document.querySelector('#pulse-animation')) {
        const style = document.createElement('style');
        style.id = 'pulse-animation';
        style.textContent = `
          @keyframes pulse {
            0%, 100% { box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
            50% { box-shadow: 0 4px 20px rgba(102, 126, 234, 0.6); }
          }
        `;
        document.head.appendChild(style);
      }
    }

    // JSONã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    function downloadJSON() {
      const jsonStr = JSON.stringify(allData, null, 2);
      const blob = new Blob([jsonStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `data-integrated_edited_${new Date().toISOString().slice(0,19).replace(/:/g,'-')}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showToast('JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚data-integrated.jsonã¨ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚', 'success');
    }

    // ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚’è¡¨ç¤º
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 16px 20px;
        background-color: ${type === 'success' ? 'var(--color-success)' : 
                          type === 'error' ? 'var(--color-error)' : 
                          'var(--color-info)'};
        color: white;
        border-radius: 8px;
        box-shadow: var(--shadow-lg);
        z-index: 10000;
        animation: slideIn 0.3s ease-out;
        max-width: 400px;
        font-size: 14px;
      `;
      toast.textContent = message;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å‹•çš„ã«è¿½åŠ 
    if (!document.querySelector('#toast-animations')) {
      const style = document.createElement('style');
      style.id = 'toast-animations';
      style.textContent = `
        @keyframes slideIn {
          from {
            transform: translateX(400px);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
        @keyframes slideOut {
          from {
            transform: translateX(0);
            opacity: 1;
          }
          to {
            transform: translateX(400px);
            opacity: 0;
          }
        }
      `;
      document.head.appendChild(style);
    }

    // ãƒ†ã‚­ã‚¹ãƒˆã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
    function highlightText(text, codes) {
      if (!text || codes.length === 0) {
        return escapeHtml(text || '');
      }
      
      // ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ«ãƒ¼ãƒ« v3.5 ã«åŸºã¥ãåŒ…æ‹¬çš„ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°
      const keywords = {
        '*CLAUSE_EXPLANATION': [
          'èª¬æ˜ä¼š', 'èª¬æ˜ã®å ´', 'èª¬æ˜', 'å‘¨çŸ¥', 'ä½æ°‘èª¬æ˜', 'è¿‘éš£èª¬æ˜', 'åœ°åŸŸä½æ°‘èª¬æ˜'
        ],
        '*CLAUSE_NEGATIVE_PERMISSION_CONSENT': [
          'ä¸è¨±å¯', 'è¨±å¯ã—ãªã„', 'æ‰¿èªã—ãªã„', 'åŒæ„ã—ãªã„', 'èªå¯ã—ãªã„'
        ],
        '*CLAUSE_POSITIVE_PERMISSION_CONSENT': [
          'å¸‚é•·', 'æ‘é•·', 'ç”ºé•·', 'è¨±å¯', 'æ‰¿èª', 'åŒæ„', 'èªå¯'
        ],
        '*CLAUSE_PENALTY_Lv2': [
          'ç½°å‰‡', 'ç½°é‡‘', 'éæ–™'
        ],
        '*CLAUSE_PENALTY_Lv1': [
          'å…¬è¡¨', 'æ°åå…¬è¡¨', 'å‹§å‘Š', 'å‘½ä»¤', 'æªç½®å‘½ä»¤', 'æªç½®ã‚’å‘½ãšã‚‹'
        ],
        '*CLAUSE_RESTRICTED_ZONE': [
          'åœŸç ‚ç½å®³ç‰¹åˆ¥è­¦æˆ’åŒºåŸŸ', 'åœŸç ‚ç½å®³è­¦æˆ’åŒºåŸŸ', 'ä¿å®‰æ—', 'å¸‚è¡—åŒ–èª¿æ•´åŒºåŸŸ',
          'æ–‡åŒ–è²¡', 'æ²³å·ä¿å…¨åŒºåŸŸ', 'æµ·å²¸ä¿å…¨åŒºåŸŸ', 'æ€¥å‚¾æ–œåœ°å´©å£Šå±é™ºåŒºåŸŸ', 'åœ°ã™ã¹ã‚Šé˜²æ­¢åŒºåŸŸ'
        ],
        '*CLAUSE_ZONE_Lv1': [
          'æŠ‘åˆ¶åŒºåŸŸ', 'åˆ¶é™åŒºåŸŸ', 'ä¿å…¨åŒºåŸŸ', 'æŠ‘åˆ¶åœ°åŒº', 'åˆ¶é™åœ°åŒº', 'ä¿å…¨åœ°åŒº'
        ],
        '*CLAUSE_ZONE_Lv2': [
          'ç¦æ­¢åŒºåŸŸ', 'ç¦æ­¢åœ°åŒº'
        ],
        '*CLAUSE_ENVIRONMENT': [
          'æ¿æ°´', 'ä½å‘¨æ³¢éŸ³', 'åå°„', 'ä½åå°„', 'æ™¯è¦³', 'ç”Ÿæ…‹ç³»', 'é¨’éŸ³', 'æŒ¯å‹•',
          'åœŸç ‚æµå‡º', 'ä¼æ¡', 'ä¿å…¨', 'ä¿è­·', 'è‡ªç„¶ç’°å¢ƒ', 'æ°´è³ª', 'åœŸå£Œ', 'å‹•æ¤ç‰©'
        ],
        '*CLAUSE_DOC_REQUIREMENTS': [
          'ç”³è«‹æ›¸', 'ç”³è«‹æ›¸é¡', 'ç”³è«‹å›³', 'ç”³è«‹å›³é¢', 'ç”³è«‹è¨ˆç”»æ›¸',
          'å±Šå‡ºæ›¸', 'å±Šå‡ºæ›¸é¡', 'å±Šå‡ºå›³', 'å±Šå‡ºå›³é¢', 'å±Šå‡ºè¨ˆç”»æ›¸',
          'æå‡ºæ›¸', 'æå‡ºæ›¸é¡', 'æå‡ºå›³', 'æå‡ºå›³é¢', 'æå‡ºè¨ˆç”»æ›¸',
          'æ·»ä»˜æ›¸é¡', 'æ·»ä»˜å›³', 'æ·»ä»˜å›³é¢'
        ],
        '*CLAUSE_DRAWINGS': [
          'ä½ç½®å›³', 'ç¾æ³å¹³é¢å›³', 'å¹³é¢å›³', 'æ–­é¢å›³', 'æ§‹é€ å›³',
          'é€ æˆè¨ˆç”»å¹³é¢å›³', 'æ’æ°´è¨ˆç”»å¹³é¢å›³', 'åœŸåœ°åˆ©ç”¨è¨ˆç”»å¹³é¢å›³', 'å…¬å›³', 'ç¾æ³å†™çœŸ'
        ],
        '*CLAUSE_DECOMMISSION_MAINTENANCE': [
          'æ’¤å»', 'åŸçŠ¶å›å¾©', 'ç¶­æŒç®¡ç†', 'ä¿å®ˆ', 'ç‚¹æ¤œ', 'è£œä¿®'
        ],
        '*CLAUSE_SIGNAGE': [
          'æ¨™è­˜', 'è¨­ç½®', 'è¡¨ç¤º', 'æ²å‡º', 'æ²ç¤º'
        ],
        '*CLAUSE_PUBLICITY': [
          'ç¸¦è¦§', 'å…¬å‘Š', 'å…¬ç¤º', 'å‘Šç¤º', 'æ„è¦‹å…¬å‹Ÿ', 'ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚³ãƒ¡ãƒ³ãƒˆ'
        ],
        '*CLAUSE_HEARING': [
          'å…¬è´ä¼š', 'æ„è¦‹è´å–', 'è´è'
        ],
        '*CLAUSE_FINANCE': [
          'è³‡é‡‘è¨ˆç”»', 'ä¿è¨¼é‡‘', 'æ‹…ä¿', 'ä¿é™º', 'è² æ‹…é‡‘'
        ],
        '*CLAUSE_EQUIPMENT_NOISE': [
          'ãƒ‘ãƒ¯ãƒ¼ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒŠãƒ¼', 'ã‚¤ãƒ³ãƒãƒ¼ã‚¿', 'PCS', 'æ©Ÿå™¨é¨’éŸ³', 'æ©Ÿå™¨ä½å‘¨æ³¢éŸ³'
        ],
        '*MODAL_PROHIBIT': [
          'ã—ã¦ã¯ãªã‚‰ãªã„', 'ç¦æ­¢ã™ã‚‹', 'ã¦ã¯ãªã‚‰ãªã„'
        ],
        '*MODAL_MUST': [
          'ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„', 'ã—ãªã‘ã‚Œã°ãªã‚‰ãš', 'ãªã‘ã‚Œã°ãªã‚‰ãªã„'
        ],
        '*MODAL_SHOULD': [
          'åŠªã‚ã‚‹', 'é…æ…®ã™ã‚‹', 'æœ›ã¾ã—ã„', 'åŠªã‚ãªã‘ã‚Œã°ãªã‚‰ãªã„'
        ],
        '*GUARD_EXCEPTION_TADASHI': [
          'ãŸã ã—', 'ä½†ã—', 'ãŸã ã—å ´åˆ', 'ä½†ã—å ´åˆ'
        ],
        '*PROCEDURE_NOTICE_MUNICIPARITY': [
          'é€šçŸ¥', 'æŒ‡ç¤º', 'å‘½ã˜ã‚‹', 'æ±‚ã‚ã‚‹'
        ],
        '*PROCEDURE_CONSULTAION': [
          'å”è­°'
        ],
        '*PROCEDURE_NOTICE_OPERATOR': [
          'å ±å‘Š', 'é€£çµ¡', 'å±Šå‡º', 'å±Šã‘å‡ºã‚‹'
        ],
        '*PROCEDURE_TIMING': [
          'äº‹å‰', 'ç€æ‰‹å‰', 'å·¥äº‹ç€æ‰‹å‰', 'å®Ÿæ–½å‰', 'ã¾ã§ã«', 'æœŸæ—¥', 'æœŸé™'
        ],
        '*STAKEHOLDER_RESIDENTS': [
          'è¿‘éš£ä½æ°‘', 'é–¢ä¿‚ä½æ°‘', 'åœ°åŸŸä½æ°‘', 'ä½æ°‘', 'å‘¨è¾ºé–¢ä¿‚è€…',
          'éš£æ¥åœŸåœ°æ‰€æœ‰è€…', 'éš£æ¥åœŸåœ°æ‰€æœ‰è€…ç­‰'
        ],
        '*CLAUSE_STAKEHOLDER_CONFIRMATION': [
          'ä½æ°‘åŒæ„', 'è¿‘éš£åŒæ„', 'é–¢ä¿‚ä½æ°‘åŒæ„', 'åœ°åŸŸä½æ°‘åŒæ„',
          'ä½æ°‘æ‰¿èª', 'ä½æ°‘è¨±å¯'
        ],
        '*STAKEHOLDER_LANDOWNER': [
          'åœŸåœ°æ‰€æœ‰è€…', 'åœ°æ¨©è€…', 'é–¢ä¿‚æ¨©åˆ©è€…'
        ],
        '*GEO_REFERENCES': [
          'è°·', 'æ²¢', 'æ€¥æ–œé¢', 'æ°´è·¯', 'æ²³å·', 'ãŸã‚æ± ', 'èª¿æ•´æ± ', 'å±±è…¹', 'å°¾æ ¹', 'è°·ç­‹'
        ]
      };
      
      let highlightedText = escapeHtml(text);
      const allKeywords = [];
      
      codes.forEach(code => {
        if (keywords[code]) {
          allKeywords.push(...keywords[code]);
        }
      });
      
      const uniqueKeywords = [...new Set(allKeywords)];
      uniqueKeywords.sort((a, b) => b.length - a.length);
      
      uniqueKeywords.forEach(keyword => {
        const regex = new RegExp(`(${escapeRegExp(keyword)})`, 'g');
        highlightedText = highlightedText.replace(regex, '<span class="highlight">$1</span>');
      });
      
      return highlightedText;
    }

    // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // æ­£è¦è¡¨ç¾ç”¨ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    function setupTabSwitching() {
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const view = btn.getAttribute('data-view');
          switchView(view);
          
          // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã‚’æ›´æ–°
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
        });
      });
    }

    function switchView(view) {
      currentView = view;
      
      document.querySelectorAll('.view-container').forEach(container => {
        container.classList.remove('active');
      });
      
      if (view === 'text') {
        document.getElementById('textView').classList.add('active');
      } else if (view === 'dashboard') {
        document.getElementById('dashboardView').classList.add('active');
        initializeDashboard();
      }
    }

    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’åˆæœŸåŒ–
    function initializeDashboard() {
      renderOverallStats();
      renderCharts();
    }

    function renderOverallStats() {
      const container = document.getElementById('overallStats');
      container.innerHTML = '';
      
      const stats = [
        { label: 'è‡ªæ²»ä½“æ•°', value: municipalities.length },
        { label: 'æ®µè½æ•°', value: allData.paragraphs.length },
        { label: 'ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç¨®é¡', value: codingTypes.length },
        { label: 'å¹³å‡å³æ ¼åº¦ã‚¹ã‚³ã‚¢', value: statistics['å³æ ¼åº¦ã‚¹ã‚³ã‚¢çµ±è¨ˆ']['å¹³å‡'].toFixed(1) },
        { label: 'å¹³å‡ä½æ°‘å‚åŠ ã‚¹ã‚³ã‚¢', value: statistics['ä½æ°‘å‚åŠ ã‚¹ã‚³ã‚¢çµ±è¨ˆ']['å¹³å‡'].toFixed(1) },
        { label: 'å¹³å‡æ‰‹ç¶šãã‚¹ã‚³ã‚¢', value: statistics['æ‰‹ç¶šãã‚¹ã‚³ã‚¢çµ±è¨ˆ']['å¹³å‡'].toFixed(1) }
      ];
      
      stats.forEach(stat => {
        const card = document.createElement('div');
        card.className = 'stat-card';
        card.innerHTML = `
          <div class="stat-value">${stat.value}</div>
          <div class="stat-label">${stat.label}</div>
        `;
        container.appendChild(card);
      });
    }

    function renderCharts() {
      // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆã‚’ç ´æ£„
      Object.values(charts).forEach(chart => {
        if (chart) chart.destroy();
      });
      charts = {};
      
      // è¦åˆ¶ã‚¿ã‚¤ãƒ—åˆ†å¸ƒ
      charts.regulation = new Chart(document.getElementById('regulationChart'), {
        type: 'pie',
        data: {
          labels: Object.keys(statistics['è¦åˆ¶ã‚¿ã‚¤ãƒ—åˆ†å¸ƒ']),
          datasets: [{
            data: Object.values(statistics['è¦åˆ¶ã‚¿ã‚¤ãƒ—åˆ†å¸ƒ']),
            backgroundColor: [
              'rgba(59, 130, 246, 0.7)',
              'rgba(245, 158, 11, 0.7)',
              'rgba(34, 197, 94, 0.7)'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: 'è¦åˆ¶ã‚¿ã‚¤ãƒ—åˆ†å¸ƒ'
            },
            legend: {
              position: 'bottom'
            }
          }
        }
      });
      
      // åŒºåŸŸé¡å‹åˆ†å¸ƒ
      charts.zone = new Chart(document.getElementById('zoneChart'), {
        type: 'bar',
        data: {
          labels: Object.keys(statistics['åŒºåŸŸé¡å‹åˆ†å¸ƒ']),
          datasets: [{
            label: 'è‡ªæ²»ä½“æ•°',
            data: Object.values(statistics['åŒºåŸŸé¡å‹åˆ†å¸ƒ']),
            backgroundColor: 'rgba(147, 51, 234, 0.7)'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: 'åŒºåŸŸé¡å‹åˆ†å¸ƒ'
            },
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
      
      // å³æ ¼åº¦åˆ†å¸ƒ
      charts.strictness = new Chart(document.getElementById('strictnessChart'), {
        type: 'doughnut',
        data: {
          labels: Object.keys(statistics['å³æ ¼åº¦_çµ¶å¯¾åˆ†å¸ƒ']),
          datasets: [{
            data: Object.values(statistics['å³æ ¼åº¦_çµ¶å¯¾åˆ†å¸ƒ']),
            backgroundColor: [
              'rgba(220, 38, 38, 0.7)',
              'rgba(234, 88, 12, 0.7)',
              'rgba(250, 204, 21, 0.7)',
              'rgba(34, 197, 94, 0.7)'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: 'å³æ ¼åº¦ãƒ¬ãƒ™ãƒ«åˆ†å¸ƒ'
            },
            legend: {
              position: 'bottom'
            }
          }
        }
      });
      
      // ãƒ—ãƒ­ã‚»ã‚¹é‡è¦–åº¦åˆ†å¸ƒ
      charts.process = new Chart(document.getElementById('processChart'), {
        type: 'bar',
        data: {
          labels: Object.keys(statistics['ãƒ—ãƒ­ã‚»ã‚¹é‡è¦–åº¦åˆ†å¸ƒ']),
          datasets: [{
            label: 'è‡ªæ²»ä½“æ•°',
            data: Object.values(statistics['ãƒ—ãƒ­ã‚»ã‚¹é‡è¦–åº¦åˆ†å¸ƒ']),
            backgroundColor: 'rgba(249, 115, 22, 0.7)'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: 'ãƒ—ãƒ­ã‚»ã‚¹é‡è¦–åº¦åˆ†å¸ƒ'
            },
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
      
      // æ•£å¸ƒå›³: å³æ ¼åº¦ vs ä½æ°‘å‚åŠ 
      const scatterData1 = municipalities.map(mun => {
        const info = municipality_info[mun];
        return {
          x: info['å³æ ¼åº¦ã‚¹ã‚³ã‚¢'],
          y: info['ä½æ°‘å‚åŠ ã‚¹ã‚³ã‚¢'],
          label: mun
        };
      });
      
      charts.scatterStrictnessResident = new Chart(document.getElementById('scatterStrictnessResident'), {
        type: 'scatter',
        data: {
          datasets: [{
            label: 'è‡ªæ²»ä½“',
            data: scatterData1,
            backgroundColor: 'rgba(59, 130, 246, 0.5)',
            borderColor: 'rgba(59, 130, 246, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: 'å³æ ¼åº¦ã‚¹ã‚³ã‚¢ vs ä½æ°‘å‚åŠ ã‚¹ã‚³ã‚¢'
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.raw.label + ': (' + 
                    context.raw.x.toFixed(1) + ', ' + 
                    context.raw.y.toFixed(1) + ')';
                }
              }
            }
          },
          scales: {
            x: {
              title: {
                display: true,
                text: 'å³æ ¼åº¦ã‚¹ã‚³ã‚¢'
              }
            },
            y: {
              title: {
                display: true,
                text: 'ä½æ°‘å‚åŠ ã‚¹ã‚³ã‚¢'
              }
            }
          }
        }
      });
      
      // æ•£å¸ƒå›³: å³æ ¼åº¦ vs æ‰‹ç¶šã
      const scatterData2 = municipalities.map(mun => {
        const info = municipality_info[mun];
        return {
          x: info['å³æ ¼åº¦ã‚¹ã‚³ã‚¢'],
          y: info['æ‰‹ç¶šãã‚¹ã‚³ã‚¢'],
          label: mun
        };
      });
      
      charts.scatterStrictnessProcedure = new Chart(document.getElementById('scatterStrictnessProcedure'), {
        type: 'scatter',
        data: {
          datasets: [{
            label: 'è‡ªæ²»ä½“',
            data: scatterData2,
            backgroundColor: 'rgba(245, 158, 11, 0.5)',
            borderColor: 'rgba(245, 158, 11, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: 'å³æ ¼åº¦ã‚¹ã‚³ã‚¢ vs æ‰‹ç¶šãã‚¹ã‚³ã‚¢'
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.raw.label + ': (' + 
                    context.raw.x.toFixed(1) + ', ' + 
                    context.raw.y.toFixed(1) + ')';
                }
              }
            }
          },
          scales: {
            x: {
              title: {
                display: true,
                text: 'å³æ ¼åº¦ã‚¹ã‚³ã‚¢'
              }
            },
            y: {
              title: {
                display: true,
                text: 'æ‰‹ç¶šãã‚¹ã‚³ã‚¢'
              }
            }
          }
        }
      });
    }

    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
    function showLoading() {
      const container = document.getElementById('paragraphs');
      container.innerHTML = '<div class="loading">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</div>';
    }

    // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
    function showError(message) {
      const container = document.getElementById('paragraphs');
      container.innerHTML = `<div class="error">ã‚¨ãƒ©ãƒ¼: ${escapeHtml(message)}</div>`;
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
    init();
  </script>
</body>
</html>
