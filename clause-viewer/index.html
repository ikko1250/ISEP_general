<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>条例テキストビューア</title>
  <style>
    :root {
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;
  --color-bg-1: rgba(59, 130, 246, 0.08);
  --color-bg-2: rgba(245, 158, 11, 0.08);
  --color-bg-3: rgba(34, 197, 94, 0.08);
  --color-bg-4: rgba(239, 68, 68, 0.08);
  --color-bg-5: rgba(147, 51, 234, 0.08);
  --color-bg-6: rgba(249, 115, 22, 0.08);
  --color-bg-7: rgba(236, 72, 153, 0.08);
  --color-bg-8: rgba(6, 182, 212, 0.08);
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;
  --space-0: 0;
  --space-1: 1px;
  --space-2: 2px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-10: 10px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.03);
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
  --container-sm: 640px;
  --container-md: 768px;
  --container-lg: 1024px;
  --container-xl: 1280px;
}

@media (prefers-color-scheme: dark) {
  :root {
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;
    --color-bg-1: rgba(29, 78, 216, 0.15);
    --color-bg-2: rgba(180, 83, 9, 0.15);
    --color-bg-3: rgba(21, 128, 61, 0.15);
    --color-bg-4: rgba(185, 28, 28, 0.15);
    --color-bg-5: rgba(107, 33, 168, 0.15);
    --color-bg-6: rgba(194, 65, 12, 0.15);
    --color-bg-7: rgba(190, 24, 93, 0.15);
    --color-bg-8: rgba(8, 145, 178, 0.15);
    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
    --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -1px 0 rgba(0, 0, 0, 0.15);
    --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);
  }
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2') format('woff2');
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  font-size: var(--font-size-base);
  font-family: var(--font-family-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
}

body {
  margin: 0;
  padding: 0;
}

.app-container {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.header {
  background-color: var(--color-surface);
  border-bottom: 1px solid var(--color-border);
  padding: var(--space-24) var(--space-32);
  box-shadow: var(--shadow-sm);
}

.header h1 {
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  letter-spacing: var(--letter-spacing-tight);
}

.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: var(--space-24);
  gap: var(--space-24);
}

@media (min-width: 1024px) {
  .main-content {
    flex-direction: row;
  }
}

.filter-section {
  flex: 0 0 auto;
  display: flex;
  flex-direction: column;
  gap: var(--space-24);
}

@media (min-width: 1024px) {
  .filter-section {
    width: 400px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
    position: sticky;
    top: var(--space-24);
  }
}

.filter-card {
  background-color: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-20);
  box-shadow: var(--shadow-sm);
}

.filter-card h2 {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  margin-bottom: var(--space-16);
  color: var(--color-text);
}

.button-grid {
  display: grid;
  gap: var(--space-8);
}

.button-grid.municipalities {
  grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
}

.button-grid.codings {
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}

.filter-btn {
  padding: var(--space-8) var(--space-12);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  background-color: var(--color-surface);
  color: var(--color-text);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
  text-align: center;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.filter-btn:hover {
  background-color: var(--color-secondary-hover);
  border-color: var(--color-primary);
}

.filter-btn:focus-visible {
  outline: none;
  box-shadow: var(--focus-ring);
}

.filter-btn.selected {
  background-color: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-color: var(--color-primary);
  font-weight: var(--font-weight-semibold);
}

.filter-btn.selected:hover {
  background-color: var(--color-primary-hover);
}

.reset-btn {
  width: 100%;
  padding: var(--space-12) var(--space-16);
  font-size: var(--font-size-base);
  font-weight: var(--font-weight-semibold);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  background-color: var(--color-surface);
  color: var(--color-text);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-standard);
}

.reset-btn:hover {
  background-color: var(--color-secondary-hover);
}

.reset-btn:focus-visible {
  outline: none;
  box-shadow: var(--focus-ring);
}

.display-section {
  flex: 1;
  min-width: 0;
}

.stats-bar {
  background-color: var(--color-bg-1);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-base);
  padding: var(--space-12) var(--space-16);
  margin-bottom: var(--space-16);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.paragraphs-container {
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
}

.paragraph-card {
  background-color: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-16);
  box-shadow: var(--shadow-sm);
  transition: box-shadow var(--duration-normal) var(--ease-standard);
}

.paragraph-card:hover {
  box-shadow: var(--shadow-md);
}

.paragraph-header {
  background-color: var(--color-bg-2);
  padding: var(--space-8) var(--space-12);
  border-radius: var(--radius-sm);
  margin-bottom: var(--space-12);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
}

.paragraph-meta {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-8);
  margin-bottom: var(--space-8);
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
}

.paragraph-text {
  font-size: var(--font-size-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  white-space: pre-wrap;
  word-wrap: break-word;
}

.highlight {
  background-color: rgba(245, 158, 11, 0.3);
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-sm);
  font-weight: var(--font-weight-medium);
}

.loading {
  text-align: center;
  padding: var(--space-32);
  font-size: var(--font-size-lg);
  color: var(--color-text-secondary);
}

.error {
  background-color: rgba(var(--color-error-rgb), 0.1);
  border: 1px solid var(--color-error);
  border-radius: var(--radius-base);
  padding: var(--space-16);
  color: var(--color-error);
  margin: var(--space-16);
}

.no-results {
  text-align: center;
  padding: var(--space-32);
  font-size: var(--font-size-base);
  color: var(--color-text-secondary);
}

/* Scrollbar styling */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--color-secondary);
  border-radius: var(--radius-sm);
}

::-webkit-scrollbar-thumb {
  background: var(--color-border);
  border-radius: var(--radius-sm);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-secondary);
}
  </style>
</head>
<body>
  <div class="app-container">
    <header class="header">
      <h1>条例テキストビューア</h1>
    </header>
    
    <main class="main-content">
      <aside class="filter-section">
        <div class="filter-card">
          <h2>自治体を選択</h2>
          <div id="municipalities" class="button-grid municipalities"></div>
        </div>
        
        <div class="filter-card">
          <h2>コーディングを選択</h2>
          <div id="codings" class="button-grid codings"></div>
        </div>
        
        <button id="resetBtn" class="reset-btn">リセット</button>
      </aside>
      
      <section class="display-section">
        <div id="stats" class="stats-bar"></div>
        <div id="paragraphs" class="paragraphs-container"></div>
      </section>
    </main>
  </div>

  <script>
    let allData = [];
    let municipalities = [];
    let codingTypes = [];
    let selectedMunicipality = null;
    let selectedCodes = [];

    // 初期化
    async function init() {
      showLoading();
      try {
        const response = await fetch('data.json');
        if (!response.ok) {
          throw new Error('データの読み込みに失敗しました');
        }
        const data = await response.json();
        
        allData = data.paragraphs || [];
        municipalities = data.municipalities || [];
        codingTypes = data.coding_types || [];
        
        initializeUI();
        displayParagraphs(allData);
      } catch (error) {
        showError(error.message);
      }
    }

    // UIを初期化
    function initializeUI() {
      // 自治体ボタンを生成
      const municipalityContainer = document.getElementById('municipalities');
      municipalities.forEach(mun => {
        const btn = document.createElement('button');
        btn.textContent = mun;
        btn.className = 'filter-btn';
        btn.setAttribute('data-municipality', mun);
        btn.addEventListener('click', () => selectMunicipality(mun, btn));
        municipalityContainer.appendChild(btn);
      });

      // コーディングボタンを生成
      const codingContainer = document.getElementById('codings');
      codingTypes.forEach(code => {
        const btn = document.createElement('button');
        btn.textContent = code;
        btn.className = 'filter-btn';
        btn.setAttribute('data-coding', code);
        btn.addEventListener('click', () => toggleCoding(code, btn));
        codingContainer.appendChild(btn);
      });

      // リセットボタン
      document.getElementById('resetBtn').addEventListener('click', resetFilters);
    }

    // 自治体を選択
    function selectMunicipality(mun, btnElement) {
      if (selectedMunicipality === mun) {
        selectedMunicipality = null;
        btnElement.classList.remove('selected');
      } else {
        // 前回の選択を解除
        document.querySelectorAll('[data-municipality].selected').forEach(b => {
          b.classList.remove('selected');
        });
        selectedMunicipality = mun;
        btnElement.classList.add('selected');
      }
      updateDisplay();
    }

    // コーディングを選択/解除
    function toggleCoding(code, btnElement) {
      const index = selectedCodes.indexOf(code);
      if (index > -1) {
        selectedCodes.splice(index, 1);
        btnElement.classList.remove('selected');
      } else {
        selectedCodes.push(code);
        btnElement.classList.add('selected');
      }
      updateDisplay();
    }

    // フィルタをリセット
    function resetFilters() {
      selectedMunicipality = null;
      selectedCodes = [];
      
      document.querySelectorAll('.filter-btn.selected').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      updateDisplay();
    }

    // 表示を更新
    function updateDisplay() {
      const filtered = filterParagraphs();
      displayParagraphs(filtered);
    }

    // 段落をフィルタリング
    function filterParagraphs() {
      let filtered = allData;
      
      // 自治体でフィルタ
      if (selectedMunicipality) {
        filtered = filtered.filter(p => p.municipality === selectedMunicipality);
      }
      
      // コーディングでフィルタ（AND条件）
      if (selectedCodes.length > 0) {
        filtered = filtered.filter(p => {
          return selectedCodes.every(code => p.codes && p.codes.includes(code));
        });
      }
      
      return filtered;
    }

    // 段落を表示
    function displayParagraphs(paragraphs) {
      const container = document.getElementById('paragraphs');
      const statsBar = document.getElementById('stats');
      
      // 統計情報を表示
      let statsText = `表示件数: ${paragraphs.length}件`;
      if (selectedMunicipality) {
        statsText += ` | 自治体: ${selectedMunicipality}`;
      }
      if (selectedCodes.length > 0) {
        statsText += ` | コーディング: ${selectedCodes.join(', ')}`;
      }
      statsBar.textContent = statsText;
      
      container.innerHTML = '';
      
      if (paragraphs.length === 0) {
        const noResults = document.createElement('div');
        noResults.className = 'no-results';
        noResults.textContent = '該当する段落が見つかりませんでした';
        container.appendChild(noResults);
        return;
      }
      
      paragraphs.forEach(para => {
        const card = document.createElement('div');
        card.className = 'paragraph-card';
        
        // ヘッダー部分
        const header = document.createElement('div');
        header.className = 'paragraph-header';
        const codes = para.codes && para.codes.length > 0 ? para.codes.join(', ') : 'コーディングなし';
        header.textContent = `[${para.h5}-${para.dan}] コーディング: ${codes}`;
        card.appendChild(header);
        
        // メタ情報
        if (para.municipality || para.year || para.category) {
          const meta = document.createElement('div');
          meta.className = 'paragraph-meta';
          if (para.municipality) {
            const munSpan = document.createElement('span');
            munSpan.textContent = `自治体: ${para.municipality}`;
            meta.appendChild(munSpan);
          }
          if (para.year) {
            const yearSpan = document.createElement('span');
            yearSpan.textContent = `年: ${para.year}`;
            meta.appendChild(yearSpan);
          }
          if (para.category) {
            const catSpan = document.createElement('span');
            catSpan.textContent = `区分: ${para.category}`;
            meta.appendChild(catSpan);
          }
          card.appendChild(meta);
        }
        
        // 本文
        const text = document.createElement('div');
        text.className = 'paragraph-text';
        text.innerHTML = highlightText(para.text, para.codes || []);
        card.appendChild(text);
        
        container.appendChild(card);
      });
    }

    // テキストをハイライト
    function highlightText(text, codes) {
      if (!text || codes.length === 0) {
        return escapeHtml(text || '');
      }
      
      // 簡易的なキーワードマッピング（実際のデータに応じて調整）
      const keywords = {
        'CLAUSE_ZONE_Lv1': ['区域', 'ゾーン', '地域'],
        'CLAUSE_ZONE_Lv2': ['地区', '範囲'],
        'CLAUSE_RESTRICTED_ZONE': ['制限区域', '禁止区域'],
        'MODAL_MUST': ['しなければならない', 'すること', '義務'],
        'MODAL_PROHIBIT': ['してはならない', '禁止', '禁ずる'],
        'MODAL_SHOULD': ['努めなければならない', '努める', '望ましい'],
        'CLAUSE_PENALTY_Lv1': ['罰金', '過料', '刑'],
        'CLAUSE_PENALTY_Lv2': ['科料', '過料'],
        'PROCEDURE_NOTICE_MUNICIPARITY': ['届出', '通知', '報告'],
        'PROCEDURE_NOTICE_OPERATOR': ['事業者', '設置者'],
        'CLAUSE_HEARING': ['意見聴取', '聴聞', 'ヒアリング'],
        'CLAUSE_EXPLANATION': ['説明', '説明会'],
        'CLAUSE_STAKEHOLDER_CONFIRMATION': ['確認', '同意'],
        'CLAUSE_POSITIVE_PERMISSION_CONSENT': ['許可', '承認', '同意'],
        'STAKEHOLDER_RESIDENTS': ['住民', '近隣'],
        'CLAUSE_DOC_REQUIREMENTS': ['書類', '図書', '資料'],
        'CLAUSE_SIGNAGE': ['標識', '看板', '表示'],
        'CLAUSE_EQUIPMENT_NOISE': ['騒音', '振動', '機器'],
        'CLAUSE_ENVIRONMENT': ['環境', '景観'],
        'CLAUSE_FINANCE': ['費用', '負担'],
        'CLAUSE_DECOMMISSION_MAINTENANCE': ['維持', '管理', '撤去'],
        'CLAUSE_PUBLICITY': ['公表', '公開'],
        'PROCEDURE_CONSULTAION': ['協議', '相談'],
        'PROCEDURE_TIMING': ['期限', '日前', '以内'],
        'GEO_REFERENCES': ['位置', '場所', '地図']
      };
      
      let highlightedText = escapeHtml(text);
      const allKeywords = [];
      
      codes.forEach(code => {
        if (keywords[code]) {
          allKeywords.push(...keywords[code]);
        }
      });
      
      // ユニークなキーワードのみ
      const uniqueKeywords = [...new Set(allKeywords)];
      
      // 長い順にソート（部分一致を避けるため）
      uniqueKeywords.sort((a, b) => b.length - a.length);
      
      uniqueKeywords.forEach(keyword => {
        const regex = new RegExp(`(${escapeRegExp(keyword)})`, 'g');
        highlightedText = highlightedText.replace(regex, '<span class="highlight">$1</span>');
      });
      
      return highlightedText;
    }

    // HTMLエスケープ
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // 正規表現用のエスケープ
    function escapeRegExp(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // ローディング表示
    function showLoading() {
      const container = document.getElementById('paragraphs');
      container.innerHTML = '<div class="loading">データを読み込んでいます...</div>';
    }

    // エラー表示
    function showError(message) {
      const container = document.getElementById('paragraphs');
      container.innerHTML = `<div class="error">エラー: ${escapeHtml(message)}</div>`;
    }

    // ページ読み込み時に初期化
    init();
  </script>
</body>
</html>