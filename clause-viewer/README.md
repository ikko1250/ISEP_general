# 条例テキストビューア - 統合分析版

太陽光発電規制条例のテキストと統計分析結果を統合したインタラクティブなWebビューアです。

## 📋 概要

このビューアは、53自治体の太陽光発電規制条例を以下の観点から分析・可視化します:

- **規制タイプ**: 許可制優位・届出制優位・混合型
- **区域類型**: 禁止地区制・抑制地区制・2層構造・区域設定なし
- **厳格度レベル**: 非常に厳格・厳格・標準・緩やか
- **プロセス重視度**: 住民参加重視型・手続き重視型など

## 🚀 使い方

### 1. データ生成

最初に統合データを生成します:

```bash
cd clause-viewer
python3 generate_integrated_data.py
```

これにより `data-integrated.json` が生成されます。

### 2. ビューアの起動

HTTPサーバーを起動:

```bash
python3 -m http.server 8080
```

ブラウザで以下にアクセス:
```
http://localhost:8080/viewer-advanced.html
```

## 🎯 主な機能

### テキスト表示モード

- **自治体フィルタ**: 特定の自治体の条例を表示
- **コーディングフィルタ**: 特定のコーディング項目を含む段落を表示
- **分析フィルタ**: 
  - 規制タイプ（許可制/届出制）
  - 区域類型（禁止地区制/抑制地区制など）
  - 厳格度レベル（非常に厳格/厳格/標準/緩やか）
  - プロセス重視度
- **複合フィルタ**: 複数のフィルタを組み合わせて絞り込み可能
- **分析バッジ表示**: 各段落カードに自治体の分類情報を表示
- **キーワードハイライト**: コーディングに関連するキーワードを自動ハイライト

### 統計ダッシュボードモード

- **全体統計**: 自治体数、段落数、平均スコアなど
- **分布グラフ**: 
  - 規制タイプ分布（円グラフ）
  - 区域類型分布（棒グラフ）
  - 厳格度レベル分布（ドーナツグラフ）
  - プロセス重視度分布（棒グラフ）
- **散布図分析**:
  - 厳格度スコア vs 住民参加スコア
  - 厳格度スコア vs 手続きスコア

## 📁 ファイル構成

```
clause-viewer/
├── viewer-advanced.html          # メインビューア（拡張版）
├── index.html                    # 基本ビューア（オリジナル）
├── data.json                     # 元の条例データ
├── data-integrated.json          # 統合データ（分析結果含む）
├── generate_integrated_data.py   # 統合データ生成スクリプト
└── README.md                     # このファイル
```

## 🔧 技術スタック

- **フロントエンド**: HTML5, CSS3, Vanilla JavaScript
- **グラフ描画**: Chart.js 4.4.0
- **データ形式**: JSON
- **デザインシステム**: カスタムCSS変数によるダークモード対応

## 📊 データ形式

### data-integrated.json の構造

```json
{
  "municipalities": ["自治体名1", "自治体名2", ...],
  "coding_types": ["コーディング1", "コーディング2", ...],
  "municipality_info": {
    "自治体名": {
      "ケース数": 100,
      "規制タイプ": "許可制優位",
      "区域類型": "2層構造(抑制+禁止)",
      "禁止区域比率": 0.3,
      "厳格度_絶対": "非常に厳格",
      "厳格度_相対": "厳格",
      "プロセス重視度": "住民参加・手続き重視型",
      "厳格度スコア": 13.8,
      "住民参加スコア": 15.5,
      "手続きスコア": 37.9
    }
  },
  "statistics": {
    "規制タイプ分布": {...},
    "区域類型分布": {...},
    "厳格度スコア統計": {...}
  },
  "paragraphs": [
    {
      "h5": 1,
      "dan": 5,
      "municipality": "大空町",
      "year": 2025,
      "category": "条例",
      "text": "条例本文...",
      "codes": ["*CLAUSE_ENVIRONMENT"]
    }
  ]
}
```

## 🎨 カスタマイズ

### スタイルのカスタマイズ

`viewer-advanced.html` の `:root` セクションでCSS変数を変更:

```css
:root {
  --color-primary: rgba(33, 128, 141, 1);
  --font-family-base: "FKGroteskNeue", ...;
  /* 他の変数... */
}
```

### フィルタの追加

新しい分析フィルタを追加する場合:

1. `initializeAnalysisFilters()` 関数に新しいフィルタを追加
2. `filterParagraphs()` 関数にフィルタリングロジックを追加
3. HTMLのサイドバーに対応するセクションを追加

## 📝 分析結果の更新

分析結果を更新する場合:

1. `solar_rule_2.ipynb` で新しい分析を実行
2. 結果を `result_solar_rule_v1.1.csv` として保存
3. `generate_integrated_data.py` を実行して統合データを再生成

```bash
python3 generate_integrated_data.py
```

## 🐛 トラブルシューティング

### データが読み込まれない

- ブラウザの開発者ツール（F12）でコンソールエラーを確認
- `data-integrated.json` が正しく生成されているか確認
- HTTPサーバーが起動しているか確認（CORSエラー回避のため）

### グラフが表示されない

- Chart.js のCDNリンクが有効か確認
- ブラウザがJavaScriptを有効にしているか確認
- 統計データが正しく読み込まれているか確認

### フィルタが動作しない

- 複数のフィルタを組み合わせると結果が0件になる場合があります
- リセットボタンで全フィルタをクリア

## 📄 ライセンス

このプロジェクトは研究目的で作成されています。

## 👥 作成者

- データ分析: `solar_rule_2.ipynb` Jupyter Notebook
- ビューア開発: GitHub Copilot

## 🔄 バージョン履歴

### v1.1 (2025-11-02)
- 統合分析版リリース
- 分析フィルタ機能追加
- 統計ダッシュボード実装
- Chart.js による可視化追加
- 分析バッジ表示機能

### v1.0 (初版)
- 基本的なテキストビューア
- 自治体・コーディングフィルタ
